source lsParentSource
{
	type		= mysql
	sql_host	= localhost
	sql_user	= root
	sql_pass	=
	sql_db		= zf2_starter_alpha
	sql_port	= 3306

    sql_sock	= /var/run/mysqld/mysqld.sock
    mysql_connect_flags	= 32
    sql_query_pre			= SET NAMES utf8
    sql_query_pre			= SET SESSION query_cache_type=OFF
}

source mailSource : lsParentSource
{
    sql_query   = SELECT * FROM mail_templates
    sql_field_string = alias
    sql_field_string = description
    sql_field_string = subject
    sql_field_string = created
    sql_field_string = updated

    sql_query_pre = \
        UPDATE sphinx_delta_counter \
        SET last_post_id = (SELECT MAX(ID) FROM mail_templates) \
        WHERE index_name = 'mail';
}

index mailIndex
{
    source = mailSource
    path = /var/lib/sphinxsearch/data/mail
}

source usersSource : lsParentSource
{
    sql_query   = SELECT * \
        FROM users \
        WHERE ID > (SELECT last_post_id FROM sphinx_delta_counter WHERE index_name = 'users');

    sql_field_string = email
    sql_field_string = displayName
    sql_field_string = role
    sql_field_string = status
    sql_attr_timestamp = created

    sql_query_pre = \
        UPDATE sphinx_delta_counter \
        SET last_post_id = (SELECT MAX(ID) FROM users) \
        WHERE index_name = 'users';

    sql_ranged_throttle = 0
}

source usersSourceDelta : lsParentSource
{
    sql_query = \
        SELECT * \
        FROM users \
        WHERE ID > (SELECT last_post_id FROM sphinx_delta_counter WHERE index_name = 'users');

    sql_field_string = email
    sql_field_string = displayName
    sql_field_string = role
    sql_field_string = status
    sql_attr_timestamp = created
}

source pagesSource : lsParentSource
{
    sql_query   = \
        SELECT id, content \
        FROM pages \
        WHERE ID > (select last_post_id FROM sphinx_delta_counter WHERE index_name = 'pages');

#    sql_field_string = title
#    sql_field_string = alias
#    sql_field_string = description
#    sql_field_string = created
#    sql_field_string = updated

    sql_query_pre = \
        UPDATE sphinx_delta_counter \
        SET last_post_id = (SELECT MAX(ID) FROM pages) \
        WHERE index_name = 'pages';
}

source pagesSourceDelta : lsParentSource
{
    sql_query   = \
        SELECT id, content \
        FROM pages \
        WHERE ID > (select last_post_id FROM sphinx_delta_counter WHERE index_name = 'pages');

#    sql_field_string = title
#    sql_field_string = alias
#    sql_field_string = description
#    sql_field_string = created
#    sql_field_string = updated
}

index usersIndex
{
    source = usersSource
    path = /var/lib/sphinxsearch/data/users
}

index usersIndexDelta
{
    source = usersSourceDelta
    path = /var/lib/sphinxsearch/data/usersDelta
}

index pagesIndex
{
    source = pagesSource
    path = /var/lib/sphinxsearch/data/pages
#    min_infix_len = 3
#    enable_star = 1
}

index pagesIndexDelta
{
    source = pagesSourceDelta
    path = /var/lib/sphinxsearch/data/pagesDelta
}

searchd
{
    listen = 127.0.0.1:9306:mysql41
    log	= /var/log/sphinxsearch/searchd.log
    query_log			= /var/log/sphinxsearch/query.log
    query_log_format = sphinxql
    pid_file			= /var/run/sphinxsearch/searchd.pid
    max_matches = 5000
}
